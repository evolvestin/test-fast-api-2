## Документация к тестовому проекту
### 1. Описание проекта
- Данный проект представляет собой API для загрузки, управления и оценки резюме. 
- API построено с использованием FastAPI, SQLAlchemy и PostgreSQL (SQLite для тестирования). 
- API поддерживает загрузку резюме, удаление, получение списка резюме и выставление рейтинга. 
- Проект включает тесты для проверки функциональности основных компонентов API.

### 2. Структура проекта
- `.env`: Содержит URL базы данных
- `app/`
  - `base.py`: Задает корневую директорию проекта.
  - `crud.py`: Содержит функции для работы с базой данных (CRUD-операции).
  - `database.py`: Отвечает за подключение к базе данных и создание таблиц.
  - `main.py`: Главный файл приложения FastAPI, содержащий настройки и инициализацию базы данных.
  - `models.py`: Описывает модели базы данных (таблиц Resume и Rating).
  - `routers.py`: Содержит эндпоинты для работы с резюме.
  - `schemas.py`: Описывает схемы данных для валидации входящих и исходящих запросов.
- `tests/`: Директория с тестами для проверки функциональности API.

### 3. Основные компоненты
#### 3.1 База данных

База данных представляет собой PostgreSQL (указано в файле .env). 
Для тестов используется SQLite. Проект использует ORM SQLAlchemy для работы с базой данных.

#### Модели:
- Модель `Resume`: Хранит оценки резюме пользователями.
  - `id`: Уникальный идентификатор резюме.
  - `candidate_name`: Имя кандидата.
  - `file_path`: Путь к файлу с резюме.
  - `rating`: Средний рейтинг резюме.
  - `num_ratings`: Количество оценок резюме.
- Модель `Rating`: Хранит оценки резюме пользователями.
  - `resume_id`: Идентификатор резюме.
  - `user_rating`: Оценка резюме.

#### 3.2. CRUD-операции
- `create_resume()`: Создает новое резюме и сохраняет его в базе данных.
- `get_resumes()`: Возвращает список резюме с возможностью пагинации (параметры skip и limit).
- `delete_resume()`: Удаляет резюме по его id.
- `rate_resume()`: Добавляет новую оценку для резюме и обновляет его средний рейтинг.

#### 3.3. API эндпоинты
- `POST /upload/`: Загрузка нового резюме. Принимает имя кандидата и файл резюме.
- `DELETE /delete/{resume_id}`: Удаление резюме по его ID.
- `GET /list/`: Получение списка резюме с поддержкой параметров skip и limit для пагинации.
- `POST /rate/`: Добавление оценки для резюме. Принимает идентификатор резюме и оценку.

#### 3.4. Тестирование

- Тесты CRUD операций:
  - `test_create_resume()`: Проверяет создание резюме.
  - `test_get_resumes()`: Проверяет получение списка резюме.
  - `test_delete_resume()`: Проверяет удаление резюме.
  - `test_rate_resume()`: Проверяет добавление оценки резюме.
- Тест базы данных:
  - `test_tables_exist()`: Проверяет наличие таблиц resumes и ratings в базе данных.
- Тесты API:
  - `test_create_resume()`: Проверяет успешное создание резюме через API.
  - `test_list_resumes()`: Проверяет получение списка резюме через API.
  - `test_delete_resume()`: Проверяет удаление резюме через API.
  - `test_rate_resume()`: Проверяет добавление оценки резюме через API.

### 4. Тестовая база данных
Для тестов используется SQLite. 
База данных создается заново перед запуском тестов, а после завершения тестов таблицы удаляются. 
Это гарантирует, что каждый тест выполняется в изолированной среде.

Файл `tests/conftest.py` содержит фикстуры для настройки тестовой базы данных и клиента для тестирования.
Тесты выполняются с использованием pytest. Каждая функция теста взаимодействует 
с API через TestClient для имитации запросов.

### 5. Как запустить проект
#### Шаги:

Клонируем:
```bash
git clone https://github.com/evolvestin/test-fast-api-2.git
```
Устанавливаем зависимости:
```bash
pip install -r requirements.txt
```
Создаем `.env` файл с переменной подключения к базе данных:
```plaintext
DATABASE_URL=postgresql://user:pass@localhost/test_fast_api
```
> Базу с таким именем необходимо создать, перед запуском

Запуск приложения:
```bash
uvicorn app.main:app --reload
```

Запуск тестов:
```bash
pytest
```
